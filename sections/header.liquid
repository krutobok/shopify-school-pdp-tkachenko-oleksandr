<header
  class="relative z-50 bg-background py-4 md:py-[30px] border-b border-border"
  data-section-id="{{ section.id }}"
>
  <div class="container-fluid flex items-center justify-between">
    <button
      id="MenuBurger"
      class="flex flex-col gap-1.5 w-6 h-6 justify-center items-center md:hidden relative z-50 cursor-pointer order-1"
      aria-label="{{ 'sections.header.menu' | t }}"
      aria-expanded="false"
      aria-controls="MenuWrapper"
    >
      <span class="block w-[18px] h-0.5 bg-foreground transition-all duration-300 origin-center"></span>
      <span class="block w-[18px] h-0.5 bg-foreground transition-all duration-300"></span>
      <span class="block w-[18px] h-0.5 bg-foreground transition-all duration-300 origin-center"></span>
    </button>

    <div
      id="MenuWrapper"
      class="
        fixed top-0 left-0 pt-14 h-full w-[85%] max-w-[360px] bg-background z-40 shadow-2xl
        flex flex-col
        transition-transform duration-300 ease-in-out
        -translate-x-full
        md:contents md:shadow-none md:transform-none md:pt-0
      "
    >
      <div class="px-6 py-6 border-b border-border/50 md:border-none md:p-0 md:mr-8 md:order-2">
        <a href="{{ routes.root_url }}" class="block w-max" aria-label="{{ shop.name }}">
          {% if section.settings.logo != blank %}
            {% assign image_size = section.settings.logo_width | append: 'x' %}
            <img
              src="{{ section.settings.logo | image_url: width: image_size }}"
              alt="{{ shop.name }}"
              width="{{ section.settings.logo_width }}"
              height="{{ section.settings.logo.height }}"
              loading="eager"
              class="object-contain"
            >
          {% else %}
            <span class="text-h2 font-bold text-foreground">{{ shop.name }}</span>
          {% endif %}
        </a>
      </div>

      <nav
        class="flex-1 overflow-y-auto md:overflow-visible md:flex-none md:order-3 md:mx-auto"
        aria-label="{{ 'sections.header.navigation_label' | t }}"
      >
        <ul class="flex flex-col px-6 md:px-0 md:flex-row md:items-center md:gap-8">
          {% for link in section.settings.menu.links %}
            <li class="w-full md:w-auto border-b border-border md:border-none last:border-none">
              <a
                href="{{ link.url }}"
                class="
                  body-large block w-full py-4 md:py-0
                  text-foreground transition-colors hover:text-secondary
                  link-animated
                  {% if link.active %} font-bold {% endif %}
                "
                {% if link.active %}
                  aria-current="page"
                {% endif %}
              >
                {{ link.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </nav>
    </div>

    <div
      id="MenuOverlay"
      class="fixed inset-0 bg-black/50 z-30 transition-opacity duration-300 opacity-0 pointer-events-none md:hidden"
      aria-hidden="true"
    ></div>

    <div class="relative z-50 flex items-center justify-end order-3 md:order-4">
      <a
        href="{{ routes.cart_url }}"
        class="relative group flex items-center justify-center w-10 h-10 md:w-auto md:h-auto overflow-visible!"
        aria-label="{{ 'templates.cart.cart' | t }}"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="w-6 h-6 text-foreground group-hover:text-secondary transition-colors"
          aria-hidden="true"
          focusable="false"
        >
          <path d="M3.55514 14.2572C2.83668 10.9043 2.47745 9.22793 3.378 8.11397C4.27855 7 5.99302 7 9.42196 7H14.5781C18.0071 7 19.7215 7 20.6221 8.11397C21.5226 9.22793 21.1634 10.9043 20.4449 14.2572L20.0164 16.2572C19.5294 18.5297 19.2859 19.666 18.4608 20.333C17.6357 21 16.4737 21 14.1495 21H9.85053C7.52639 21 6.36432 21 5.53925 20.333C4.71418 19.666 4.47069 18.5297 3.98372 16.2572L3.55514 14.2572Z" stroke="currentColor" stroke-width="1.5"/>
          <path d="M3 11H21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M10 14H14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M18 9L15 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M6 9L9 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>

        {% if cart.item_count > 0 %}
          <span
            class="absolute -top-1 -right-1 bg-black text-white text-[10px] font-bold h-4 w-4 flex items-center justify-center rounded-full pointer-events-none"
            aria-hidden="true"
          >
            {{ cart.item_count }}
          </span>
          <span class="sr-only">{{ 'sections.header.cart_count.other' | t: count: cart.item_count }}</span>
        {% endif %}
      </a>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const menuBurger = document.getElementById('MenuBurger');
    const menuWrapper = document.getElementById('MenuWrapper');
    const menuOverlay = document.getElementById('MenuOverlay');

    if (!menuBurger || !menuWrapper) return;

    const spans = menuBurger.querySelectorAll('span');

    function toggleMenu() {
      if (window.innerWidth >= 768) return;

      const isExpanded = menuBurger.getAttribute('aria-expanded') === 'true';
      const newExpandedState = !isExpanded;
      menuBurger.setAttribute('aria-expanded', newExpandedState);
      menuWrapper.classList.toggle('-translate-x-full');

      if (menuOverlay) {
        if (newExpandedState) {
          menuOverlay.classList.remove('pointer-events-none', 'opacity-0');
        } else {
          menuOverlay.classList.add('pointer-events-none', 'opacity-0');
        }
      }
      if (newExpandedState) {
        document.body.style.overflow = 'hidden';
        spans[0].classList.add('rotate-45', 'translate-y-[8px]');
        spans[1].classList.add('opacity-0');
        spans[2].classList.add('-rotate-45', '-translate-y-[8px]');
      } else {
        document.body.style.overflow = '';
        spans[0].classList.remove('rotate-45', 'translate-y-[8px]');
        spans[1].classList.remove('opacity-0');
        spans[2].classList.remove('-rotate-45', '-translate-y-[8px]');
      }
    }

    menuBurger.addEventListener('click', toggleMenu);
    if (menuOverlay) {
      menuOverlay.addEventListener('click', toggleMenu);
    }
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 10,
      "default": 100,
      "unit": "px",
      "label": "Logo width"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    }
  ],
  "presets": [
    {
      "name": "Header"
    }
  ]
}
{% endschema %}
